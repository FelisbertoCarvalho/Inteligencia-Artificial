;;; projeto.lisp
;;; Interface principal com o utilizador
;;; Carrega: puzzle.lisp e procura.lisp
;;; Lê: problemas.dat



;; ------------ ferramentas simples ------------
(defun read-int (prompt &optional min max)
  "Lê um inteiro com prompt; valida intervalo se min/max fornecidos."
  (format t "~a" prompt)
  (let ((v (read)))
    (if (and (integerp v) (or (null min) (>= v min)) (or (null max) (<= v max)))
        v
        (progn (format t "Entrada inválida. Tenta novamente.~%")
               (read-int prompt min max)))))

(defun read-str (prompt)
  (format t "~a" prompt)
  (finish-output)
  (let ((s (read-line)))
    (if s s (read-str prompt))))

(defun yes-no-p (prompt)
  (format t "~a (s/n): " prompt)
  (let ((r (string-downcase (read-line))))
    (cond ((or (string= r "s") (string= "sim")) t)
          ((or (string= r "n") (string= "nao") (string= "não")) nil)
          (t (format t "Resposta inválida.~%") (yes-no-p prompt)))))




;; ------------ carregar modulos ------------

;; Fazer (setf *default-pathname-defaults* #P"C:/PastaProjeto/") no Listener

(defun carregar-modulos ()
  "Carrega os ficheiros puzzle.lisp e procura.lisp"
  (load "puzzle.lisp")
  ; (load "procura.lisp")
)


(defun ler-problemas ()
  "Lê os problemas do ficheiro problemas.dat"
    (with-open-file (stream "problemas.dat")
      (loop for prob = (read stream nil)
            while prob
            collect prob))
)

(defun print-problemas ()
  "Imprime a lista dos tabuleiros disponíveis"
  (format t "Tabuleiros disponíveis: ~%")
  (loop for i from 1 to (length (ler-problemas)) do
        (format t "~A -> Tabuleiro ~A~%" i i))
)

(defun escolher-problema ()
  "Permite ao utilizador escolher um problema pelo índice e devolve o tabuleiro escolhido"
  (print-problemas)
  (format t "Escolha um problema: ")
  (let ((op (read)))
    (nth (1- op) (ler-problemas)))
)


