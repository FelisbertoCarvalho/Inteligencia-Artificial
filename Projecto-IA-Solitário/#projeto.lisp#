;;; projeto.lisp
;;; Interface principal com o utilizador
;;; Carrega: puzzle.lisp e procura.lisp
;;; Le: problemas.dat


;; Fazer (setf *default-pathname-defaults* #P"C:/PastaProjeto/") no Listener

(defun carregar-ficheiros ()
  "Carrega os ficheiros puzzle.lisp e procura.lisp."
  (load "puzzle.lisp")
  ; (load "procura.lisp")
)


;; Ler e imprimir ficheiro problemas.dat

(defun ler-problemas ()
  "Le os problemas do ficheiro problemas.dat."
    (with-open-file (stream "problemas.dat")
      (loop for problema = (read stream nil)
            while problema
            collect problema))
)

(defun print-problemas ()
  "Imprime a lista dos tabuleiros disponiveis."
  (format t "Tabuleiros disponíveis: ~%")
  (loop for i from 1 to (length (ler-problemas)) do
        (format t "~A -> Tabuleiro ~A~%" i i))
)


;; Listas de escolhas

(defun menu-principal ()
  "Imprime o menu principal que inicia a interacao com o utilizador."
  (format t "~%--- Bem-vindo ao jogo do Solitario! ---~%")
  (format t "1 - Jogar Solitario~%")
  (format t "2 - Sair~%")
  (format t "> ")
  (read)
)

(defun escolher-problema ()
  "Permite ao utilizador escolher um problema pelo indice e devolve o tabuleiro escolhido."
  (print-problemas)
  (format t "Escolha um problema: ")
  (let ((option (read)))
    (nth (1- option) (ler-problemas)))
)

(defun escolher-algoritmo ()
  "Imprime a lista de algoritmos disponiveis e espera pela escolha do utilizador."
  (format t "~%- Escolha um algoritmo: ~%")
  (format t "1 - BFS~%")
  (format t "2 - DFS~%")
  (format t "3 - A*~%")
  (format t "4 - IDA*~%")
  (format t "5 - SMA*~%")
  (format t "> ")
  (read)
)

(defun escolher-heuristica ()
  "Imprime a lista de heuristicas disponiveis e espera pela escolha do utilizador."
  (format t "~%- Escolha uma heuristica: ~%")
  (format t "1 - Heuristica 1~%")
  (format t "2 - Heuristica 2~%")
  (format t "> ")
  (read)
)


;; Loop principal

(defun main ()
  "Loop principal do programa, imprime o menu principal."
  (carregar-ficheiros)
  (ola)
  (loop
     (let ((option (menu-principal)))
       (cond ((= option 1) 
              (let* (
                  (problema (escolher-problema)) 
                  (algoritmo (escolher-algoritmo)) 
                  (heuristica (if (> algoritmo 2)
                                  (escolher-heuristica)
                                   nil))
                  (resultado (executar-procura problema algoritmo heuristica))
                )
                (mostrar-resultado resultado)
                ))
             ((= option 2)(format t "A sair do jogo...~%")
              (return))
             (t (format t "Opcao invalida!~%")))))
)


;; Executar algoritmos

(defun executar-procura (tabuleiro algoritmo heuristica)
  "Executa o algoritmo escolhido pelo utilizador num dos tabuleiros."
  (cond ((= algoritmo 1) (bfs tabuleiro))
        ((= algoritmo 2) (dfs tabuleiro 30))
        ((= algoritmo 3) (a* tabuleiro))
        ((= algoritmo 4) (ida* tabuleiro))
        ((= algoritmo 5) (sma* tabuleiro 30))
        (t (format t "Algoritmo invalido!~%")))
)

(defun mostrar-resultado (resultado)
  "Mostra a solução da procura no ecrã."
  (format t "-> Solucao encontrada: ~A" resultado)
)